import logging

from telethon import events

from .. import loader, utils

logger = logging.getLogger(__name__)

def register(client):
    client.add_event_handler(event_handler, events.NewMessage(pattern=r"\.newsid"))
    client.add_event_handler(event_handler, events.NewMessage(pattern=r"\.news"))

async def event_handler(event):
    if event.pattern_match.group(0) == ".newsid":
        # Save the channel IDs
        channel_ids = event.pattern_match.group(1).split(",")
        channel_ids = [int(x.strip()) for x in channel_ids]
        await event.edit(f"News channel IDs set to: {channel_ids}")

    elif event.pattern_match.group(0) == ".news":
        # Get the saved channel IDs
        channel_ids = await event.client.get_shared_config("news_channel_ids")
        if channel_ids is None:
            await event.edit(self.strings("not_set", event))
            return

